<div class="container mx-auto" id="api-key-container" phx-hook="ApiKey">
  <h1 class="text-3xl font-bold mb-4">OpenAI Realtime Elixir Demo</h1>

  <%= if Phoenix.Flash.get(@flash, :error) do %>
    <div
      class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4"
      role="alert"
    >
      <span class="block sm:inline"><%= Phoenix.Flash.get(@flash, :error) %></span>
    </div>
  <% end %>

  <div class="mb-4">
    <%= if @api_key_set do %>
      <p>API Key is set</p>
      <button phx-click="remove_api_key" class="bg-red-500 text-white px-4 py-2 rounded">
        Remove API Key
      </button>
    <% else %>
      <form phx-submit="set_api_key">
        <input
          type="password"
          name="api_key"
          placeholder="Enter your OpenAI API Key"
          class="border p-2 mr-2"
        />
        <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded">
          Set API Key
        </button>
      </form>
    <% end %>
  </div>
  <%= if @api_key_set do %>
    <div>
      <%= if @connected_to_realtime do %>
        <button
          phx-click="disconnect_from_realtime"
          class="bg-red-500 text-white px-4 py-2 rounded"
        >
          Disconnect
        </button>
      <% else %>
        <button phx-click="connect_to_realtime" class="bg-blue-500 text-white px-4 py-2 rounded">
          Connect
        </button>
      <% end %>
    </div>
  <% end %>
  <%= if @connection_error do %>
    <div class="mt-4 text-red-500">
      Connection error: <%= @connection_error %>
    </div>
  <% end %>
  <%= if @connected_to_realtime do %>
    <div id="voice-chat" phx-hook="VoiceChat">
      <button phx-click="voice_chat_started" class="bg-blue-500 text-white px-4 py-2 rounded">
        Start Recording
      </button>
      <button phx-click="voice_chat_stopped" class="bg-red-500 text-white px-4 py-2 rounded">
        Stop Recording
      </button>
      <!-- Move the transcript inside the voice-chat div -->
      <div id="transcript"></div>
    </div>
  <% end %>
</div>
